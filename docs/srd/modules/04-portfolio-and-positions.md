---
标题：模块规范 — 投资组合和持仓
版本：0.1
最后更新：2025-12-14
所有者：产品与工程
状态：草稿
---

# 1. 模块概述

## 模块名称和标识符
- 名称：投资组合和持仓
- ID：MOD-PORTFOLIO-POSITIONS

## 目的
为用户提供在特定市场中的当前持仓可见性，包括潜在利润以及在持有对冲头寸时的对冲指导。

## 范围
- 范围内：“我的持仓”概览和市场视图中的详细信息，包括对冲提示逻辑和解释性文案。
- 范围外：跨所有市场的投资组合管理（PRD中未描述）；本SRD侧重于市场本地的投资组合可见性。

## 模块边界
从显示市场持仓开始，到用户导航离开市场或更改选择上下文结束。

## 依赖项
- 投资组合端点 ([投资组合 API](../api-specifications/portfolio.md))
- 投注提交后的更新依赖交易模块 ([交易和投注](03-trading-and-betting.md))
- 市场上下文（marketId，期权定义）([市场详情](02-market-details.md))

## 利益相关者
- 最终用户、产品、工程

# 2. 功能需求

## 需求列表
- FR-PP-001：系统应在市场视图中显示一个“我的持仓”部分。
- FR-PP-001A（MVP）：在市场详情页中，“我的持仓”应在投注区域之后以可滚动阅读的方式内联展示。
- FR-PP-002：该部分应显示一个摘要，包括：
  - 在该市场中的总投注额
  - 最大潜在利润（最佳情况）
- FR-PP-003：该部分应列出持仓条目，显示：
  - 方向/支持的期权
  - 状态标签（例如，“持有中”）
  - 投注金额
  - 该持仓的潜在利润
- FR-PP-004：如果用户在同一市场中对对冲选项持有头寸，系统应显示一个对冲提示，解释最大收益的降低和部分回报的特性。
- FR-PP-005：如果用户在该市场中没有持仓，系统应显示一个空状态，提示用户下注。

## 用户故事
- 作为一个最终用户，我希望看到我投入了多少以及我的潜在利润，以便我能管理我的风险。
- 作为一个最终用户，我希望在跨对冲结果持有头寸时得到通知，以便我了解我的回报情况。

## 用例
### UC-PP-001：下注后查看持仓
- 执行者：最终用户
- 前置条件：用户在该市场中至少有一笔投注
- 主流程：
  1. 用户查看市场。
  2. 系统加载并显示持仓摘要和列表。
  3. 如果存在对冲选项，系统显示对冲提示。
- 后置条件：用户了解当前风险敞口和潜在结果。

## 业务规则
- BR-PP-001：“最大潜在利润”定义为基于当前持仓和支付规则的跨结果的最佳情况利润。如果客户端无法获取完整的支付规则，服务器必须提供此值。
- BR-PP-002：当用户在一个投注中持有超过一个互斥结果组的敞口时，触发对冲提示。

## 验证规则
- VR-PP-001：显示的持仓必须属于经过身份验证的用户和当前市场。

# 3. API 规范（技术无关）
完整的合约请参见 [投资组合 API](../api-specifications/portfolio.md)。

## 端点定义（摘要）
- `GET /api/portfolio/markets/{marketId}/summary`
- `GET /api/portfolio/markets/{marketId}/positions`

## 错误处理
- [通用错误](../api-specifications/common-errors.md) 中的标准错误信封。

# 4. 数据模型和模式
请参阅 [实体](../data-models/entities.md) 和 [JSON 模式](../data-models/json-schemas.md)。

## 使用的关键实体
- Position（持仓），PortfolioSummary（投资组合摘要）

# 5. 业务逻辑需求
- BL-PP-001：持仓必须按投注和期权分组，以支持对冲检测和显示。
- BL-PP-002：对冲提示内容必须保持一致，除非支付模型在数学上保证（待定；默认为“部分回报，最大收益有限”），否则不应暗示保证利润。

# 6. 集成点
- 查看持仓不需要钱包/支付的余额，但可能用于其他地方的“全部”快速投注操作。

# 7. 非功能性需求
- NFR-PP-001：持仓必须在下注后及时更新。
- NFR-PP-002：系统必须通过阻止访问其他用户的持仓来保护用户隐私。

# 8. 验收标准
- AC-PP-001：成功下注后，持仓列表在无需手动重新加载的情况下包含新的敞口。
- AC-PP-002：在没有持仓的情况下，显示带有下注提示的空状态。
- AC-PP-003：当持有对冲期权时，显示对冲提示。
