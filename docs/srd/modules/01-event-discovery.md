---
标题：模块规范 — 赛事发现
版本：0.1
最后更新：2025-12-14
所有者：产品与工程部
状态：草稿
---

# 1. 模块概述

## 模块名称和标识符
- 名称：赛事发现（体育主页）
- ID：MOD-EVENT-DISCOVERY

## 目的
通过特色推荐、分类筛选和一致的赛事/盘口卡片设计，使用户能够快速发现可交易的体育预测盘口。

## 范围
- 范围内：体育主页布局、特色/热门盘口轮播、分类筛选器、盘口列表排序、盘口卡片及其卡片交互（打开详情、快速投注入口）。
- 范围外：详细盘口交易流程（参见`modules/03-trading-and-betting.md`）和详细盘口页面渲染（参见`modules/02-market-details.md`）。

## 模块边界
从用户访问体育体验主页开始，到用户导航到盘口详情页或从卡片发起投注时结束。

## 依赖项
- 盘口列表和特色选择 API（[Events API](../api-specifications/events.md)，[Markets API](../api-specifications/markets.md)）
- 运营配置（特色/置顶）([Operations and Configuration](07-operations-and-configuration.md))
- 体育分类法和赛事元数据（体育类别、联赛、开始时间）

## 利益相关者
- 最终用户、博彩公司（作为发现者）、运营、产品、工程

# 2. 功能需求

## 需求列表
- FR-ED-001：系统应渲染体育主页，包含**两个区域**：(1) 特色/热门盘口区域和 (2) 全部盘口列表区域。
- FR-ED-002：特色/热门区域应以卡片形式展示**最多 3 个盘口**，并在移动客户端支持水平滑动。
- FR-ED-003：特色/热门选择应遵循以下优先级顺序：(1) 运营置顶，其次是 (2) 活跃盘口中投注额最高的，其次是 (3) 活跃盘口中参与人数最多的。
- FR-ED-004：完整列表区域应显示标题，格式为“所有体育 X 场比赛”或“[分类] X 场比赛”，其中 X 是当前筛选范围内盘口的数量。
- FR-ED-005：左侧筛选面板应显示“所有体育”以及每个体育分类及其关联的活跃盘口数量。
- FR-ED-006：默认筛选条件为“所有体育”，显示所有**活跃**盘口。
- FR-ED-007：选择一个体育分类应更新筛选状态并刷新盘口列表，仅显示该分类中的盘口。
- FR-ED-008：完整列表应按以下降序优先级排序：(1) 置顶权重，(2) 热门度得分，(3) 创建时间（新的在前）。
- FR-ED-009：热门度得分计算公式为：`参与人数 * 0.4 + 规范化投注额 * 0.4 + 过去24小时增量 * 0.2`。
- FR-ED-010：盘口卡片应支持至少两种显示类型：正面交锋（head-to-head）赛事和冠军/未来赛（futures）赛事。
- FR-ED-011：盘口卡片应显示投注选项预览：
  - 如果存在 2-3 个选项，则全部显示。
  - 如果存在 4 个或更多选项，则显示前 3 个以及一个“更多 +N”条目。
- FR-ED-012：领先选项（份额最高）的进度指示器应为红色；份额最低的应为绿色；中间份额的应为蓝色。
- FR-ED-013：由博彩公司预设为“博彩公司估计”的选项应有明显的标签。
- FR-ED-014：点击盘口卡片的非选项区域应导航至盘口详情视图。
- FR-ED-015：点击卡片上的投注选项预览应启动该选项的投注流程，除非该选项已锁定；锁定的选项不可操作。

## 用户故事
- 作为一个最终用户，我希望首先看到最热门的盘口，以便我能快速加入活跃的讨论和流动性。
- 作为一个最终用户，我希望按体育分类筛选，以便我只看到相关的盘口。
- 作为一个最终用户，我希望从卡片打开盘口详情，以便我在投注前查看趋势和规则。
- 作为一个最终用户，我希望直接从卡片开始投注，以便我能快速参与。

## 用例
### UC-ED-001：浏览特色盘口
- 参与者：最终用户
- 前置条件：客户端可以访问特色盘口列表
- 主要流程：
  1. 用户访问体育主页。
  2. 系统使用选择优先级加载特色盘口。
  3. 系统渲染最多 3 个特色卡片；用户可以在移动设备上水平滑动。
- 备选流程：
  - A1：符合条件的特色盘口少于 3 个 → 系统仅显示可用的盘口。
  - A2：特色选择服务不可用 → 系统显示特色区域的空状态，但如果可能，仍加载完整列表。
- 后置条件：用户可以导航到任何特色盘口或从预览选项开始投注。

### UC-ED-002：按体育分类筛选盘口
- 参与者：最终用户
- 前置条件：体育分类可用
- 主要流程：
  1. 用户点击筛选面板中的一个体育分类。
  2. 系统更新筛选状态并刷新列表。
  3. 标题更新为“[分类] X 场比赛”。
- 后置条件：只显示所选分类中的盘口。

### UC-ED-003：从卡片打开盘口
- 参与者：最终用户
- 前置条件：至少渲染了一个盘口卡片
- 主要流程：
  1. 用户点击卡片主体（非选项区域）。
  2. 系统导航到盘口详情。
  3. 系统保留之前的筛选状态以供返回导航。

## 业务规则
- BR-ED-001：特色选择优先级应为：置顶 > 最高投注额（仅活跃）> 最高参与人数（仅活跃）。
- BR-ED-002：完整列表排序优先级应为：置顶权重 > 热门度得分 > 创建时间。
- BR-ED-003：热门度得分权重应如 FR-ED-009 中定义，为 0.4 / 0.4 / 0.2。
- BR-ED-004：“活跃”盘口是指状态为 `ACTIVE` 的盘口（参见`modules/06-market-states-and-settlement.md`）。
- BR-ED-005：如果选项数量 ≤ 3，则不显示“更多 +N”。

## 验证规则
- VR-ED-001：筛选选择必须是已知的体育分类或“所有体育”；否则系统应恢复为“所有体育”。

# 3. API 规范（与技术无关）
此模块主要使用只读端点；详细合同在 [Events API](../api-specifications/events.md) 和 [Markets API](../api-specifications/markets.md) 中。

## 端点定义（摘要）
- `GET /api/sports`
- `GET /api/markets/featured?limit=3`
- `GET /api/markets?status=active&sportId={sportId?}&sort=priority`

## 身份验证/授权
- 只读发现端点可能根据业务策略是公开的或需要经过身份验证的访问；如果需要身份验证，请使用 `cross-cutting-concerns/authentication-and-authorization.md` 中的标准方案。

## 错误处理
- 使用 [Common Errors](../api-specifications/common-errors.md) 中的标准错误信封。

# 4. 数据模型和模式
请参阅 [Entities](../data-models/entities.md) 和 [JSON Schemas](../data-models/json-schemas.md) 中共享的定义。

## 使用的关键实体
- SportCategory, League, Event, PredictionMarket, MarketOption, FeaturedMarketConfig

# 5. 业务逻辑需求

## 排序和评分
- BL-ED-001：热门度得分计算在给定的时间窗口和输入下必须是稳定的。
- BL-ED-002：投注额的规范化方法在不同盘口之间应保持一致（参见 [Events API](../api-specifications/events.md)）。

## 卡片渲染逻辑
- BL-ED-003：卡片的选项预览顺序按选项份额降序排列，显示前 3 个。
- BL-ED-004：进度指示器的颜色基于排名：顶部=红色，底部=绿色，其他=蓝色。

# 6. 集成点
- 体育数据提供商：赛事元数据（联赛、队伍、开始时间）。
- 运营配置：置顶盘口和置顶权重。

# 7. 非功能性需求
- NFR-ED-001：主页在加载盘口时必须提供清晰的加载状态（骨架卡片）。
- NFR-ED-002：筛选更新结果时应具有最小的可感知延迟；如果数据获取超过可接受的阈值，则显示上下文中的加载指示器。
- NFR-ED-003：系统不得对锁定的选项显示可操作的“投注”入口。

# 8. 验收标准
- AC-ED-001：在配置了置顶特色盘口的情况下，特色区域显示的盘口应优先于任何计算出的热门度。
- AC-ED-002：切换分类时，标题和计数会更新，列表仅包含匹配的盘口。
- AC-ED-003：排序顺序尊重置顶权重，然后是热门度得分，最后是最新创建时间。
- AC-ED-004：对于具有 4 个或更多选项的盘口，恰好显示 3 个选项加上“更多 +N”。
- AC-ED-005：点击卡片主体会打开盘口详情，并且返回导航会恢复之前的筛选状态。