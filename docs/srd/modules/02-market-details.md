---
标题：模块规范 — 市场详情
版本：0.1
最后更新：2025-12-14
所有者：产品与工程
状态：草稿
---

# 1. 模块概览

## 模块名称和标识符
- 名称：市场详情
- ID：MOD-MARKET-DETAILS

## 目的
为用户提供一个全面的预测市场视图，包括选项细分、市场趋势、规则和裁决信息，并能够无缝过渡到投注环节。

## 范围
- 范围内：市场标题、选项列表和选择状态、市场趋势图表、交易提示、规则选项卡、裁决选项卡以及返回导航行为。
- 范围外：投注执行和钱包扣款（参见 `modules/03-trading-and-betting.md`）。

## 模块边界
当用户导航到特定市场时开始，当用户导航离开或完成投注流程时结束。

## 依赖项
- 市场读取 API ([Markets API](../api-specifications/markets.md))
- 价格历史/时间序列 ([Markets API](../api-specifications/markets.md))
- 规则/裁决工件 ([Markets API](../api-specifications/markets.md), [Market States and Settlement](06-market-states-and-settlement.md))
- 交易报价/投注模块集成 ([Trading and Betting](03-trading-and-betting.md))

## 利益相关者
- 最终用户、产品、工程、风险/合规（为确保规则/裁决清晰）

# 2. 功能需求

## 需求列表
- FR-MD-001：系统应显示一个返回导航控件，该控件可返回体育主页并保留先前的筛选状态。
- FR-MD-002：系统应显示市场标题信息，包括：图片、标题、解释性文本和概览指标（参与者、总流动性）。
- FR-MD-003：系统应显示一个选项列表，其中每个选项显示：选项图标、选项名称、已支持金额（或等价口径）、份额/比例百分比、十进制赔率（如可用）以及参与者预览（如适用）。
- FR-MD-004：选择选项列表中的一个选项应更新投注面板的上下文（所选选项），而不会丢失用户输入的投注金额，除非用户明确重置。
- FR-MD-005：市场详情视图应提供至少包含：趋势、规则、裁决的选项卡导航。
- FR-MD-006：“趋势”选项卡应显示一个多系列图表，显示一段时间内的选项份额，具有可选的时间范围：1H、1D、1W、1M、ALL（默认 ALL）。
- FR-MD-007：系统应在图表下方显示交易提示消息，以鼓励负责任的参与并提供市场平衡的背景信息。
- FR-MD-008：“规则”选项卡应以清晰、用户可读的形式展示市场规则。
- FR-MD-009：“裁决”选项卡应以清晰、用户可读的形式展示裁决状态和/或结果详情。
- FR-MD-010：当市场处于非 `ACTIVE` 状态时，详情视图应反映状态标签并相应地限制操作（参见 `modules/06-market-states-and-settlement.md`）。
- FR-MD-011（MVP）：裁决页签应展示外部依赖信息与挑战期（例如：Oracle=UMA Protocol、仲裁=Kleros Court、挑战期=2小时）以及“乐观预言机”说明性文案（参见 `integrations/oracle-and-dispute-resolution.md`）。
- FR-MD-012（MVP）：如果某选项被标记为锁定（例如庄家持仓/庄家锁定），则该选项必须显示锁定标识，并且不得作为可下注选项被选中（详见 `modules/03-trading-and-betting.md` 的交易限制）。

## 用户故事
- 作为一个最终用户，我希望看到选项份额和趋势，以便我能做出明智的投注决策。
- 作为一个最终用户，我希望阅读市场规则和裁决信息，以便我了解结果是如何确定的。

## 用例
### UC-MD-001：查看市场详情
- 执行者：最终用户
- 前置条件：市场存在且可访问
- 主要流程：
  1. 用户导航到市场详情。
  2. 系统加载市场标题、选项和摘要指标。
  3. 系统默认显示“趋势”选项卡并加载时间序列（ALL）。
- 替代流程：
  - A1：时间序列不可用 → 系统显示非阻塞错误状态并保持选项可见。
  - A2：市场已结束/已结算 → 系统显示状态标签并禁用投注操作。

### UC-MD-002：切换趋势时间范围
- 执行者：最终用户
- 前置条件：“趋势”图表可用
- 主要流程：用户选择一个时间范围；系统重新加载并重绘该范围的图表。

## 业务规则
- BR-MD-001：默认趋势范围是 ALL。
- BR-MD-002：市场状态标签和可操作性必须遵循 `modules/06-market-states-and-settlement.md` 中的状态模型。
- BR-MD-003（MVP）：规则页签至少需要覆盖以下规则要点（如适用）：
  - 市场根据官方赛果结算。
  - 比赛延期超过 24 小时可取消并退款。
  - 所有时间口径以 UTC 展示/解释。
  - 足球赛事若未特殊声明，默认指 90 分钟常规时间（含补时），不含加时赛与点球大战。

## 验证规则
- VR-MD-001：如果某个选项不可用于投注（已锁定或市场不活跃），UI 必须不允许选择它进行投注操作。

# 3. API 规范（技术无关）
有关完整的合约，请参阅 [Markets API](../api-specifications/markets.md)。

## 端点定义（摘要）
- `GET /api/markets/{marketId}`
- `GET /api/markets/{marketId}/options`
- `GET /api/markets/{marketId}/price-history?range={1h|1d|1w|1m|all}`
- `GET /api/markets/{marketId}/rules`
- `GET /api/markets/{marketId}/adjudication`

## 错误处理
- 使用 [Common Errors](../api-specifications/common-errors.md) 中的标准错误。

# 4. 数据模型和架构
请参阅 [Entities](../data-models/entities.md) 和 [JSON Schemas](../data-models/json-schemas.md) 中的共享定义。

## 使用的关键实体
- PredictionMarket（预测市场）, MarketOption（市场选项）, MarketPriceSeries（市场价格序列）, MarketRule（市场规则）, Adjudication（裁决）

# 5. 业务逻辑需求

## 选项选择同步
- BL-MD-001：选项选择立即更新投注面板的上下文。
- BL-MD-002：市场摘要指标（参与者、总流动性、选项份额）必须在单个刷新周期内保持内部一致性。

## 趋势可视化
- BL-MD-003：时间序列点必须按时间戳升序排列。
- BL-MD-004：对于每个时间戳，选项份额以百分比（0–100）表示。

# 6. 集成点
- 结算/裁决提供商（用于裁决结果）。
- 配置提供商（用于规则展示模板，如果适用）。

# 7. 非功能性需求
- NFR-MD-001：详情页面在获取市场数据时必须显示加载状态。
- NFR-MD-002：图表渲染在移动屏幕上必须保持可用。
- NFR-MD-003：规则和裁决内容必须清晰易读且可访问。

# 8. 验收标准
- AC-MD-001：返回导航应返回体育主页并保留先前的类别选择。
- AC-MD-002：选择一个选项应高亮显示该选项并更新投注面板上下文。
- AC-MD-003：趋势时间范围选择器应触发正确的图表更新。
- AC-MD-004：如果市场已结束或已结算，投注入口点将被禁用且状态标签可见。
