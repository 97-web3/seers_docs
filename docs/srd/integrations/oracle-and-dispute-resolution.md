---
标题：集成 — 预言机与争议解决（UMA / Kleros）
版本：0.1
最后更新：2025-12-14
所有者：产品与工程
状态：草稿
---

# 集成 — 预言机与争议解决（UMA / Kleros）

## 1. 目的
为市场结算提供可验证的结果来源，并在结果存在争议时提供争议解决机制，以支持“裁决”与“结算”信息的用户可见性与可追溯性。

## 2. 集成范围
- 结果提交：任何允许的提交方可以提交某市场的候选结果（“乐观预言机”模式）。
- 挑战期：在挑战期内可对候选结果提出异议。
- 仲裁：若发生争议，结果进入仲裁流程；仲裁方输出最终决定。
- 决定传播：系统将最终决定写入裁决记录，并触发/允许结算执行。

## 3. 关键业务规则（与客户端可见性相关）
- BR-ODR-001：系统必须为每个市场维护裁决状态，并在客户端“裁决”页签中展示。
- BR-ODR-002：在挑战期内，候选结果不得视为最终结果；必须明确标注“挑战期进行中”。
- BR-ODR-003：若发生争议，系统必须标注为“有争议/仲裁中”，并在最终决定前保持只读展示。
- BR-ODR-004：挑战期长度（例如 2 小时）必须是可配置的，并在客户端可见。
- BR-ODR-005：本版本采用以下外部依赖作为集成基线：
  - 预言机（Oracle）：UMA Protocol
  - 仲裁方（Arbitration）：Kleros Court

## 4. 接口要求（技术无关）
- 系统必须能够查询或接收以下字段，并以权威记录形式返回给客户端（详见 `api-specifications/markets.md` 的 `GET /api/markets/{marketId}/adjudication`）：
  - 预言机提供方标识（例如 UMA Protocol）
  - 仲裁提供方标识（例如 Kleros Court）
  - 挑战期开始时间与结束时间
  - 当前裁决状态（挑战期中/有争议/已决定等）
  - 最终获胜选项（若已决定）
  - 说明/备注（可选）

## 5. 可靠性与故障模式
- 如果预言机/仲裁提供方不可用，系统必须：
  - 保持市场为只读状态（不允许结算推进）
  - 对客户端返回可理解的“裁决信息暂不可用”的提示（参见 `cross-cutting-concerns/error-handling-and-messaging.md`）
  - 记录可观测性信号（参见 `cross-cutting-concerns/observability.md`）

## 6. 安全与合规
- 裁决相关数据必须防篡改；客户端显示必须来自权威记录而非可被本地修改的缓存。
- 若涉及外部链上/第三方交互，系统必须保证凭证与密钥不暴露给未授权客户端（实现选择）。

