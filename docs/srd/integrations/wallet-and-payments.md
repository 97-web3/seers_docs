---
标题：集成 — 钱包和支付
版本：0.1
最后更新：2025-12-14
所有者：产品与工程
状态：草稿
---

# 集成 — 钱包和支付

## 1. 目的
提供用户余额并支持在投注和创建博彩公司市场时扣除余额。

## 2. 功能集成点
- 用于显示和验证（投注和市场创建）的余额检索。
- 扣款：
  - 投注时：扣除赌注（以及根据政策适用的费用）。
  - 创建市场时：扣除（或预留）初始总流动资金。
- 充值入口：在余额不足流程中触发的可导航路径或外部链接。
- 提现入口（MVP）：客户端可以提供提现入口点（例如按钮/菜单项）；其实现细节不在 SRD 范围内，但必须遵循认证与授权要求。

## 3. 接口要求
- 钱包余额必须能够实时或近实时检索。
- 扣款必须是**幂等的**，使用与发起操作相同的幂等性键。
- 在相关情况下，必须返回稳定的 `INSUFFICIENT_BALANCE`（余额不足）错误代码。

## 4. 安全要求
- 余额和扣款需要经过身份验证的请求。
- 系统不得允许用户操作其他用户的钱包。

## 5. 故障模式和后备方案
- 如果钱包不可用：
  - 投注放置必须安全失败并返回可重试的错误。
  - 市场创建必须安全失败，不创建市场或锁定资金。
