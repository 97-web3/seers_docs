---
标题：错误处理和消息传递
版本：0.1
最后更新：2025-12-14
所有者：产品与工程
状态：草稿
---

# 错误处理和消息传递

## 1. 原则
- 优先使用可操作的、用户可读的消息和稳定的机器可读的错误代码。
- 对于可恢复的错误，保留用户输入。
- 在模块间（发现、详情、交易、创建）使用一致的模式。

## 2. API 错误信封
请参阅 `api-specifications/common-errors.md`。

## 3. 客户端用户体验要求
- 网络错误：显示“网络错误，请重试”的提示信息（toast/banner），并在可能的情况下提供重试操作。
- 余额不足：显示一个带有充值入口的对话框，并且不清除输入内容。
- 市场关闭：显示“市场已关闭；投注不可用”，并禁用相关操作。
- 下注失败：显示具体原因（从错误代码映射），并保留投注金额输入。

## 4. 日志记录和关联性
- 每个客户端请求应包含一个请求标识符（在请求头中或由客户端生成）。
- 服务器响应的错误信封中必须包含 `requestId`，以便于支持。